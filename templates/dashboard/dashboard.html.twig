{% extends 'base.html.twig' %}

{% block title %}Hello HomeController!{% endblock %}

{% block body %}
<style>
    .container { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .beneficiary-search { margin: 20px 0; }
</style>

<div class="container">
    <h1>List of non persisted beneficiaries</h1>

    <div class="beneficiary-search">
        <div>
            <label>
                <input type="text" id="searchInput" placeholder="Rechercher un bénéficiaire...">
            </label>
        </div>
    </div>

    <div class="beneficiary-list">
        {% for beneficiary in beneficiaries %}
            <div class="beneficiary-card">
                <img class="beneficiary-avatar" src="{{ beneficiary.avatarUrl }}" alt="Avatar de {{ beneficiary.name }}" width="64" height="64"/>
                <span class="beneficiary-name">{{ beneficiary.name }}</span>
            </div>
        {% endfor %}
    </div>
</div>

<script>
    const searchInput = document.getElementById('searchInput');

    // Fonction pour supprimer accents et mettre en minuscule
    function normalize(str) {
        return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
    }

    searchInput.addEventListener('input', function () {
        const query = normalize(this.value);
        const cards = document.querySelectorAll('.beneficiary-card');

        cards.forEach(card => {
            const nameEl = card.querySelector('.beneficiary-name');
            if (!nameEl) return;

            const name = normalize(nameEl.textContent);
            const match = name.includes(query);
            card.style.display = (!query || match) ? 'block' : 'none';
        });
    });
</script>

{% endblock %}